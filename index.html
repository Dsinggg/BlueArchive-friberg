<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蔚蓝档案 · 弗一把</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        input, button {
            padding: 10px;
            margin: 10px;
        }
        #guessResult {
            margin-top: 20px;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .colored-text {
            font-weight: bold;
        }
        #startOverBtn {
            display: none;
            margin: 20px auto;
        }
        .hint {
            color: gray;
            font-size: 12px;
        }
        /* Define color classes */
        .correct { background-color: lightgreen; }
        .incorrect { background-color: lightcoral; }
        .close { background-color: lightyellow; }
    </style>
</head>
<body>
    <h1>蔚蓝档案 · 弗一把</h1>
    <p>请输入学生姓名，开始猜测吧！&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;作者：Dsing</p>
    <input type="text" id="userInput" placeholder="输入学生姓名..." oninput="showHints()">
    <button onclick="submitGuess()">提交猜测</button>

    <div id="hints" class="hint"></div>

    <table>
        <thead>
            <tr>
                <th>姓名</th>
                <th>学院</th>
                <th>社团</th>
                <th>年龄</th>
                <th>战略定位</th>
                <th>攻击属性</th>
            </tr>
        </thead>
        <tbody id="guessResult"></tbody>
    </table>

    <button id="startOverBtn" onclick="startOver()">重新开始</button>

    <script>
        const characters = [
            {
                name: "星野（泳装）", academy: "阿拜多斯", club: "对策委员会", age: 17, position: "前排", attack: "爆发"
            },
            {
                name: "和香", academy: "红冬", club: "227号特别班", age: 16, position: "后排", attack: "爆发"
            },
            {
                name: "星野", academy: "阿拜多斯", club: "对策委员会", age: 17, position: "前排", attack: "贯穿"
            },
        ];

        let correctAnswer = characters[Math.floor(Math.random() * characters.length)];
        let attempts = 0;
        
        function showHints() {
            const input = document.getElementById("userInput").value.trim();
            
            if (input === "" || input === "(" || input === ")") {
                document.getElementById("hints").innerText = "";
                return;
            }
        
            const hints = characters.filter(character => character.name.toLowerCase().includes(input.toLowerCase()))
                .map(character => character.name)
                .join(", ");
            
            document.getElementById("hints").innerText = hints ? "可选角色： " + hints : "";
        }
        
        function submitGuess() {
            const userGuess = document.getElementById("userInput").value.trim();
            const guessCharacter = characters.find(character => character.name === userGuess);

            if (!guessCharacter) {
                alert("请输入有效的角色姓名！");
                return;
            }

            attempts++;
            let resultHTML = "<tr>";
            const properties = ["name", "academy", "club", "age", "position", "attack"];
            properties.forEach(property => {
                let correctValue = correctAnswer[property];
                let guessValue = guessCharacter[property];
                let className = "incorrect";
                let displayValue = guessValue;

                if (property === "name") {
                    if (guessValue === correctValue) {
                        className = "correct";
                    } else if (guessValue.split('（')[0] === correctValue.split('（')[0]) {
                        className = "close";
                    }
                } else if (property === "age") {
                    if (guessValue === correctValue) {
                        className = "correct";
                    } else if (guessValue < correctValue) {
                        className = "incorrect";
                        displayValue = `${guessValue} ↑`;
                    } else {
                        className = "incorrect";
                        displayValue = `${guessValue} ↓`;
                    }
                } else if (guessValue === correctValue) {
                    className = "correct";
                }

                let coloredText = "";
                if (property === "position") {
                    coloredText = getPositionColor(guessCharacter.position);
                }
                if (property === "attack") {
                    coloredText = getAttackColor(guessCharacter.attack);
                }

                resultHTML += `<td class="${className}">${coloredText || displayValue}</td>`;
            });
            resultHTML += "</tr>";
            document.getElementById("guessResult").insertAdjacentHTML('beforeend', resultHTML);

            if (userGuess === correctAnswer.name) {
                endGame();
            }

            document.getElementById("userInput").value = '';
        }

        function getPositionColor(position) {
            switch (position) {
                case "突击": return '<span style="color: rgb(204, 26, 37);">突击</span>';
                case "支援": return '<span style="color: rgb(0, 107, 255);">支援</span>';
                default: return position;
            }
        }

        function getAttackColor(attack) {
            switch (attack) {
                case "爆发": return '<span style="color: rgb(167, 12, 25);">爆发</span>';
                case "贯穿": return '<span style="color: rgb(178, 109, 31);">贯穿</span>';
                case "神秘": return '<span style="color: rgb(33, 111, 156);">神秘</span>';
                case "振动": return '<span style="color: rgb(148, 49, 165);">振动</span>';
                default: return attack;
            }
        }

        function endGame() {
            alert(`猜对了！你用了 ${attempts} 次尝试`);
            document.getElementById("userInput").disabled = true;
            document.querySelector("button[onclick='submitGuess()']").disabled = true;
            document.getElementById("startOverBtn").style.display = "block";
        }

        function startOver() {
            correctAnswer = characters[Math.floor(Math.random() * characters.length)];
            attempts = 0;
            document.getElementById("userInput").disabled = false;
            document.querySelector("button[onclick='submitGuess()']").disabled = false;
            document.getElementById("startOverBtn").style.display = "none";
            document.getElementById("guessResult").innerHTML = "";
            document.getElementById("hints").innerText = "";
        }
    </script>
</body>
</html>
